#!/usr/bin/env node
import assert from "node:assert/strict";
import { ArgumentParser, ArgumentDefaultsHelpFormatter, Namespace, } from "argparse";
import { launch } from "./browser.js";
import { runConfigForArgs } from "./config.js";
import { getLogger, LoggingLevel } from "./logging.js";
import { measureURL } from "./measure.js";
import { BrowserType, MeasurementType } from "./types.js";
const parser = new ArgumentParser({
    description: "Run performance tests for a playwright version of a browser.",
    formatter_class: ArgumentDefaultsHelpFormatter,
});
parser.add_argument("-b", "--browser", {
    choices: Object.values(BrowserType),
    default: BrowserType.Brave,
    help: "Which browser family to use for this test.",
});
parser.add_argument("-m", "--measurements", {
    choices: Object.values(MeasurementType),
    default: Object.values(MeasurementType),
    help: "Which measurements of performance to collect. By default, performs all " +
        "measurements.",
});
parser.add_argument("-d", "--user-data-dir", {
    help: "Path to the user data directory to load and save persistent state " +
        "to. For chromium browsers, this will be a directory containing multiple " +
        "profiles. For other browsers, this directory will be the state for " +
        "a single profile. If not provided, will create a new temporary " +
        "user-data directory.",
});
parser.add_argument("-p", "--profile", {
    default: "Default",
    help: "For chromium runs, this is the name of the profile in an existing " +
        "--user-data-dir directory to load. (Only used for Chromium browsers)",
});
parser.add_argument("-t", "--timeout", {
    default: 30,
    help: "Number of seconds to wait for the browser to complete tasks " +
        "separate from loading the given page (e.g., open the browser, " +
        "navigate to the given URL, etc.)",
    type: "int",
});
parser.add_argument("-s", "--seconds", {
    default: 30,
    help: "Number of seconds to wait while measuring page performance.",
    type: "int",
});
parser.add_argument("-x", "--binary-path", {
    help: "Path to the browser binary to run the measurements with. Note that " +
        "this argument is only valid for Chromium-family browsers, since " +
        "Chromium family browsers do not require any playwright patches, " +
        "while the gecko and webkit ones do.",
});
parser.add_argument("-u", "--url", {
    help: "The URL to run measurements against. Should be a full URL (i.e., " +
        "at least a scheme and a domain).",
    required: true,
    type: URL,
});
parser.add_argument("--height", {
    default: 1024,
    help: "The height of the browser viewport to use when loading pages.",
    type: "int",
});
parser.add_argument("--width", {
    default: 1280,
    help: "The width of the browser viewport to use when loading pages.",
    type: "int",
});
parser.add_argument("--logging", {
    choices: Object.values(LoggingLevel),
    default: LoggingLevel.Info,
    help: "What level of information to include when printing information during " +
        "the measurement.",
});
const rawArgs = parser.parse_args();
assert(rawArgs instanceof Namespace);
const runConfig = await runConfigForArgs(rawArgs);
const { measurements, url, seconds, timeout, loggingLevel } = runConfig;
const logger = getLogger(loggingLevel);
const browserContext = await launch(logger, runConfig);
const results = await measureURL(logger, browserContext, url, seconds, timeout, measurements);
console.log(JSON.stringify(results));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxNQUFNLE1BQU0sb0JBQW9CLENBQUM7QUFFeEMsT0FBTyxFQUNMLGNBQWMsRUFDZCw2QkFBNkIsRUFDN0IsU0FBUyxHQUNWLE1BQU0sVUFBVSxDQUFDO0FBRWxCLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDdEMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3ZELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFMUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxjQUFjLENBQUM7SUFDaEMsV0FBVyxFQUFFLDhEQUE4RDtJQUMzRSxlQUFlLEVBQUUsNkJBQTZCO0NBQy9DLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRTtJQUNyQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDbkMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxLQUFLO0lBQzFCLElBQUksRUFBRSw0Q0FBNEM7Q0FDbkQsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUU7SUFDMUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDO0lBQ3ZDLE9BQU8sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQztJQUN2QyxJQUFJLEVBQ0YseUVBQXlFO1FBQ3pFLGVBQWU7Q0FDbEIsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsaUJBQWlCLEVBQUU7SUFDM0MsSUFBSSxFQUNGLG9FQUFvRTtRQUNwRSwwRUFBMEU7UUFDMUUscUVBQXFFO1FBQ3JFLGlFQUFpRTtRQUNqRSxzQkFBc0I7Q0FDekIsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsV0FBVyxFQUFFO0lBQ3JDLE9BQU8sRUFBRSxTQUFTO0lBQ2xCLElBQUksRUFDRixvRUFBb0U7UUFDcEUsc0VBQXNFO0NBQ3pFLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRTtJQUNyQyxPQUFPLEVBQUUsRUFBRTtJQUNYLElBQUksRUFDRiw4REFBOEQ7UUFDOUQsZ0VBQWdFO1FBQ2hFLGtDQUFrQztJQUNwQyxJQUFJLEVBQUUsS0FBSztDQUNaLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRTtJQUNyQyxPQUFPLEVBQUUsRUFBRTtJQUNYLElBQUksRUFBRSw2REFBNkQ7SUFDbkUsSUFBSSxFQUFFLEtBQUs7Q0FDWixDQUFDLENBQUM7QUFDSCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUU7SUFDekMsSUFBSSxFQUNGLHFFQUFxRTtRQUNyRSxrRUFBa0U7UUFDbEUsa0VBQWtFO1FBQ2xFLHFDQUFxQztDQUN4QyxDQUFDLENBQUM7QUFDSCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUU7SUFDakMsSUFBSSxFQUNGLG1FQUFtRTtRQUNuRSxrQ0FBa0M7SUFDcEMsUUFBUSxFQUFFLElBQUk7SUFDZCxJQUFJLEVBQUUsR0FBRztDQUNWLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFO0lBQzlCLE9BQU8sRUFBRSxJQUFJO0lBQ2IsSUFBSSxFQUFFLCtEQUErRDtJQUNyRSxJQUFJLEVBQUUsS0FBSztDQUNaLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFO0lBQzdCLE9BQU8sRUFBRSxJQUFJO0lBQ2IsSUFBSSxFQUFFLDhEQUE4RDtJQUNwRSxJQUFJLEVBQUUsS0FBSztDQUNaLENBQUMsQ0FBQztBQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFO0lBQy9CLE9BQU8sRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUNwQyxPQUFPLEVBQUUsWUFBWSxDQUFDLElBQUk7SUFDMUIsSUFBSSxFQUNGLHdFQUF3RTtRQUN4RSxrQkFBa0I7Q0FDckIsQ0FBQyxDQUFDO0FBRUgsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsRUFBYSxDQUFDO0FBQy9DLE1BQU0sQ0FBQyxPQUFPLFlBQVksU0FBUyxDQUFDLENBQUM7QUFFckMsTUFBTSxTQUFTLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNsRCxNQUFNLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxHQUFHLFNBQVMsQ0FBQztBQUN4RSxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDdkMsTUFBTSxjQUFjLEdBQUcsTUFBTSxNQUFNLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ3ZELE1BQU0sT0FBTyxHQUFHLE1BQU0sVUFBVSxDQUM5QixNQUFNLEVBQ04sY0FBYyxFQUNkLEdBQUcsRUFDSCxPQUFPLEVBQ1AsT0FBTyxFQUNQLFlBQVksQ0FDYixDQUFDO0FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5pbXBvcnQgYXNzZXJ0IGZyb20gXCJub2RlOmFzc2VydC9zdHJpY3RcIjtcblxuaW1wb3J0IHtcbiAgQXJndW1lbnRQYXJzZXIsXG4gIEFyZ3VtZW50RGVmYXVsdHNIZWxwRm9ybWF0dGVyLFxuICBOYW1lc3BhY2UsXG59IGZyb20gXCJhcmdwYXJzZVwiO1xuXG5pbXBvcnQgeyBsYXVuY2ggfSBmcm9tIFwiLi9icm93c2VyLmpzXCI7XG5pbXBvcnQgeyBydW5Db25maWdGb3JBcmdzIH0gZnJvbSBcIi4vY29uZmlnLmpzXCI7XG5pbXBvcnQgeyBnZXRMb2dnZXIsIExvZ2dpbmdMZXZlbCB9IGZyb20gXCIuL2xvZ2dpbmcuanNcIjtcbmltcG9ydCB7IG1lYXN1cmVVUkwgfSBmcm9tIFwiLi9tZWFzdXJlLmpzXCI7XG5pbXBvcnQgeyBCcm93c2VyVHlwZSwgTWVhc3VyZW1lbnRUeXBlIH0gZnJvbSBcIi4vdHlwZXMuanNcIjtcblxuY29uc3QgcGFyc2VyID0gbmV3IEFyZ3VtZW50UGFyc2VyKHtcbiAgZGVzY3JpcHRpb246IFwiUnVuIHBlcmZvcm1hbmNlIHRlc3RzIGZvciBhIHBsYXl3cmlnaHQgdmVyc2lvbiBvZiBhIGJyb3dzZXIuXCIsXG4gIGZvcm1hdHRlcl9jbGFzczogQXJndW1lbnREZWZhdWx0c0hlbHBGb3JtYXR0ZXIsXG59KTtcbnBhcnNlci5hZGRfYXJndW1lbnQoXCItYlwiLCBcIi0tYnJvd3NlclwiLCB7XG4gIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoQnJvd3NlclR5cGUpLFxuICBkZWZhdWx0OiBCcm93c2VyVHlwZS5CcmF2ZSxcbiAgaGVscDogXCJXaGljaCBicm93c2VyIGZhbWlseSB0byB1c2UgZm9yIHRoaXMgdGVzdC5cIixcbn0pO1xucGFyc2VyLmFkZF9hcmd1bWVudChcIi1tXCIsIFwiLS1tZWFzdXJlbWVudHNcIiwge1xuICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKE1lYXN1cmVtZW50VHlwZSksXG4gIGRlZmF1bHQ6IE9iamVjdC52YWx1ZXMoTWVhc3VyZW1lbnRUeXBlKSxcbiAgaGVscDpcbiAgICBcIldoaWNoIG1lYXN1cmVtZW50cyBvZiBwZXJmb3JtYW5jZSB0byBjb2xsZWN0LiBCeSBkZWZhdWx0LCBwZXJmb3JtcyBhbGwgXCIgK1xuICAgIFwibWVhc3VyZW1lbnRzLlwiLFxufSk7XG5wYXJzZXIuYWRkX2FyZ3VtZW50KFwiLWRcIiwgXCItLXVzZXItZGF0YS1kaXJcIiwge1xuICBoZWxwOlxuICAgIFwiUGF0aCB0byB0aGUgdXNlciBkYXRhIGRpcmVjdG9yeSB0byBsb2FkIGFuZCBzYXZlIHBlcnNpc3RlbnQgc3RhdGUgXCIgK1xuICAgIFwidG8uIEZvciBjaHJvbWl1bSBicm93c2VycywgdGhpcyB3aWxsIGJlIGEgZGlyZWN0b3J5IGNvbnRhaW5pbmcgbXVsdGlwbGUgXCIgK1xuICAgIFwicHJvZmlsZXMuIEZvciBvdGhlciBicm93c2VycywgdGhpcyBkaXJlY3Rvcnkgd2lsbCBiZSB0aGUgc3RhdGUgZm9yIFwiICtcbiAgICBcImEgc2luZ2xlIHByb2ZpbGUuIElmIG5vdCBwcm92aWRlZCwgd2lsbCBjcmVhdGUgYSBuZXcgdGVtcG9yYXJ5IFwiICtcbiAgICBcInVzZXItZGF0YSBkaXJlY3RvcnkuXCIsXG59KTtcbnBhcnNlci5hZGRfYXJndW1lbnQoXCItcFwiLCBcIi0tcHJvZmlsZVwiLCB7XG4gIGRlZmF1bHQ6IFwiRGVmYXVsdFwiLFxuICBoZWxwOlxuICAgIFwiRm9yIGNocm9taXVtIHJ1bnMsIHRoaXMgaXMgdGhlIG5hbWUgb2YgdGhlIHByb2ZpbGUgaW4gYW4gZXhpc3RpbmcgXCIgK1xuICAgIFwiLS11c2VyLWRhdGEtZGlyIGRpcmVjdG9yeSB0byBsb2FkLiAoT25seSB1c2VkIGZvciBDaHJvbWl1bSBicm93c2VycylcIixcbn0pO1xucGFyc2VyLmFkZF9hcmd1bWVudChcIi10XCIsIFwiLS10aW1lb3V0XCIsIHtcbiAgZGVmYXVsdDogMzAsXG4gIGhlbHA6XG4gICAgXCJOdW1iZXIgb2Ygc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgYnJvd3NlciB0byBjb21wbGV0ZSB0YXNrcyBcIiArXG4gICAgXCJzZXBhcmF0ZSBmcm9tIGxvYWRpbmcgdGhlIGdpdmVuIHBhZ2UgKGUuZy4sIG9wZW4gdGhlIGJyb3dzZXIsIFwiICtcbiAgICBcIm5hdmlnYXRlIHRvIHRoZSBnaXZlbiBVUkwsIGV0Yy4pXCIsXG4gIHR5cGU6IFwiaW50XCIsXG59KTtcbnBhcnNlci5hZGRfYXJndW1lbnQoXCItc1wiLCBcIi0tc2Vjb25kc1wiLCB7XG4gIGRlZmF1bHQ6IDMwLFxuICBoZWxwOiBcIk51bWJlciBvZiBzZWNvbmRzIHRvIHdhaXQgd2hpbGUgbWVhc3VyaW5nIHBhZ2UgcGVyZm9ybWFuY2UuXCIsXG4gIHR5cGU6IFwiaW50XCIsXG59KTtcbnBhcnNlci5hZGRfYXJndW1lbnQoXCIteFwiLCBcIi0tYmluYXJ5LXBhdGhcIiwge1xuICBoZWxwOlxuICAgIFwiUGF0aCB0byB0aGUgYnJvd3NlciBiaW5hcnkgdG8gcnVuIHRoZSBtZWFzdXJlbWVudHMgd2l0aC4gTm90ZSB0aGF0IFwiICtcbiAgICBcInRoaXMgYXJndW1lbnQgaXMgb25seSB2YWxpZCBmb3IgQ2hyb21pdW0tZmFtaWx5IGJyb3dzZXJzLCBzaW5jZSBcIiArXG4gICAgXCJDaHJvbWl1bSBmYW1pbHkgYnJvd3NlcnMgZG8gbm90IHJlcXVpcmUgYW55IHBsYXl3cmlnaHQgcGF0Y2hlcywgXCIgK1xuICAgIFwid2hpbGUgdGhlIGdlY2tvIGFuZCB3ZWJraXQgb25lcyBkby5cIixcbn0pO1xucGFyc2VyLmFkZF9hcmd1bWVudChcIi11XCIsIFwiLS11cmxcIiwge1xuICBoZWxwOlxuICAgIFwiVGhlIFVSTCB0byBydW4gbWVhc3VyZW1lbnRzIGFnYWluc3QuIFNob3VsZCBiZSBhIGZ1bGwgVVJMIChpLmUuLCBcIiArXG4gICAgXCJhdCBsZWFzdCBhIHNjaGVtZSBhbmQgYSBkb21haW4pLlwiLFxuICByZXF1aXJlZDogdHJ1ZSxcbiAgdHlwZTogVVJMLFxufSk7XG5wYXJzZXIuYWRkX2FyZ3VtZW50KFwiLS1oZWlnaHRcIiwge1xuICBkZWZhdWx0OiAxMDI0LFxuICBoZWxwOiBcIlRoZSBoZWlnaHQgb2YgdGhlIGJyb3dzZXIgdmlld3BvcnQgdG8gdXNlIHdoZW4gbG9hZGluZyBwYWdlcy5cIixcbiAgdHlwZTogXCJpbnRcIixcbn0pO1xucGFyc2VyLmFkZF9hcmd1bWVudChcIi0td2lkdGhcIiwge1xuICBkZWZhdWx0OiAxMjgwLFxuICBoZWxwOiBcIlRoZSB3aWR0aCBvZiB0aGUgYnJvd3NlciB2aWV3cG9ydCB0byB1c2Ugd2hlbiBsb2FkaW5nIHBhZ2VzLlwiLFxuICB0eXBlOiBcImludFwiLFxufSk7XG5wYXJzZXIuYWRkX2FyZ3VtZW50KFwiLS1sb2dnaW5nXCIsIHtcbiAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhMb2dnaW5nTGV2ZWwpLFxuICBkZWZhdWx0OiBMb2dnaW5nTGV2ZWwuSW5mbyxcbiAgaGVscDpcbiAgICBcIldoYXQgbGV2ZWwgb2YgaW5mb3JtYXRpb24gdG8gaW5jbHVkZSB3aGVuIHByaW50aW5nIGluZm9ybWF0aW9uIGR1cmluZyBcIiArXG4gICAgXCJ0aGUgbWVhc3VyZW1lbnQuXCIsXG59KTtcblxuY29uc3QgcmF3QXJncyA9IHBhcnNlci5wYXJzZV9hcmdzKCkgYXMgdW5rbm93bjtcbmFzc2VydChyYXdBcmdzIGluc3RhbmNlb2YgTmFtZXNwYWNlKTtcblxuY29uc3QgcnVuQ29uZmlnID0gYXdhaXQgcnVuQ29uZmlnRm9yQXJncyhyYXdBcmdzKTtcbmNvbnN0IHsgbWVhc3VyZW1lbnRzLCB1cmwsIHNlY29uZHMsIHRpbWVvdXQsIGxvZ2dpbmdMZXZlbCB9ID0gcnVuQ29uZmlnO1xuY29uc3QgbG9nZ2VyID0gZ2V0TG9nZ2VyKGxvZ2dpbmdMZXZlbCk7XG5jb25zdCBicm93c2VyQ29udGV4dCA9IGF3YWl0IGxhdW5jaChsb2dnZXIsIHJ1bkNvbmZpZyk7XG5jb25zdCByZXN1bHRzID0gYXdhaXQgbWVhc3VyZVVSTChcbiAgbG9nZ2VyLFxuICBicm93c2VyQ29udGV4dCxcbiAgdXJsLFxuICBzZWNvbmRzLFxuICB0aW1lb3V0LFxuICBtZWFzdXJlbWVudHMsXG4pO1xuXG5jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4iXX0=