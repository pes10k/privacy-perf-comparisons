export class BaseMeasurer {
    logger;
    url;
    context;
    isContextClosed = false;
    instrumentedAt;
    closedAt;
    constructor(logger, url, context) {
        this.logger = logger;
        this.url = url;
        this.context = context;
        this.instrument();
    }
    logInfo(...msg) {
        this.#log(this.logger.info, ...msg);
    }
    logVerbose(...msg) {
        this.#log(this.logger.verbose, ...msg);
    }
    logError(...msg) {
        this.#log(this.logger.error, ...msg);
    }
    #log(logFunc, ...msg) {
        logFunc.call(this.logger, "MEASURER:", this.measurementType().toUpperCase(), ": ", ...msg);
    }
    measurementType() {
        throw new Error("Method not implemented");
    }
    instrument() {
        this.context.on("close", () => {
            this.isContextClosed = true;
        });
        if (this.instrumentedAt) {
            throw new Error("Trying to instrument a measurer instance after it " +
                `was instrumented at "${this.instrumentedAt.toISOString()}"`);
        }
        this.instrumentedAt = new Date();
    }
    close() {
        if (this.closedAt) {
            this.logError("Tried to close measurement, but it was already " + "closed at ", this.closedAt.toISOString());
            return false;
        }
        this.closeIfOpen();
        return true;
    }
    closeIfOpen() {
        if (this.closedAt) {
            return false;
        }
        this.closedAt = new Date();
        this.logVerbose("Ending measurement at ", this.closedAt.toISOString());
        return true;
    }
    // eslint-disable-next-line @typescript-eslint/require-await
    async collect() {
        throw new Error("Method not implemented");
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tZWFzdXJlbWVudHMvYmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFVQSxNQUFNLE9BQU8sWUFBWTtJQUNkLE1BQU0sQ0FBUztJQUNmLEdBQUcsQ0FBTTtJQUNULE9BQU8sQ0FBaUI7SUFFakMsZUFBZSxHQUFHLEtBQUssQ0FBQztJQUN4QixjQUFjLENBQVE7SUFDdEIsUUFBUSxDQUFRO0lBRWhCLFlBQVksTUFBYyxFQUFFLEdBQVEsRUFBRSxPQUF1QjtRQUMzRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRUQsT0FBTyxDQUFDLEdBQUcsR0FBYztRQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFVBQVUsQ0FBQyxHQUFHLEdBQWM7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxRQUFRLENBQUMsR0FBRyxHQUFjO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsSUFBSSxDQUFDLE9BQWdCLEVBQUUsR0FBRyxHQUFjO1FBQ3RDLE9BQU8sQ0FBQyxJQUFJLENBQ1YsSUFBSSxDQUFDLE1BQU0sRUFDWCxXQUFXLEVBQ1gsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUNwQyxJQUFJLEVBQ0osR0FBRyxHQUFHLENBQ1AsQ0FBQztJQUNKLENBQUM7SUFFRCxlQUFlO1FBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxVQUFVO1FBQ1IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtZQUM1QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxLQUFLLENBQ2Isb0RBQW9EO2dCQUNsRCx3QkFBd0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUMvRCxDQUFDO1FBQ0osQ0FBQztRQUNELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQsS0FBSztRQUNILElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxRQUFRLENBQ1gsaURBQWlELEdBQUcsWUFBWSxFQUNoRSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUM1QixDQUFDO1lBQ0YsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNsQixPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyx3QkFBd0IsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7UUFDdkUsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsNERBQTREO0lBQzVELEtBQUssQ0FBQyxPQUFPO1FBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQzVDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJyb3dzZXJDb250ZXh0IH0gZnJvbSBcIkBwbGF5d3JpZ2h0L3Rlc3RcIjtcblxuaW1wb3J0IHsgTG9nRnVuYywgTG9nZ2VyIH0gZnJvbSBcIi4uL2xvZ2dpbmcuanNcIjtcbmltcG9ydCB7IE1lYXN1cmVtZW50VHlwZSB9IGZyb20gXCIuLi90eXBlcy5qc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lYXN1cmVtZW50UmVzdWx0IHtcbiAgdHlwZTogTWVhc3VyZW1lbnRUeXBlO1xuICBkYXRhOiB1bmtub3duO1xufVxuXG5leHBvcnQgY2xhc3MgQmFzZU1lYXN1cmVyIHtcbiAgcmVhZG9ubHkgbG9nZ2VyOiBMb2dnZXI7XG4gIHJlYWRvbmx5IHVybDogVVJMO1xuICByZWFkb25seSBjb250ZXh0OiBCcm93c2VyQ29udGV4dDtcblxuICBpc0NvbnRleHRDbG9zZWQgPSBmYWxzZTtcbiAgaW5zdHJ1bWVudGVkQXQ/OiBEYXRlO1xuICBjbG9zZWRBdD86IERhdGU7XG5cbiAgY29uc3RydWN0b3IobG9nZ2VyOiBMb2dnZXIsIHVybDogVVJMLCBjb250ZXh0OiBCcm93c2VyQ29udGV4dCkge1xuICAgIHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuICAgIHRoaXMudXJsID0gdXJsO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5pbnN0cnVtZW50KCk7XG4gIH1cblxuICBsb2dJbmZvKC4uLm1zZzogdW5rbm93bltdKSB7XG4gICAgdGhpcy4jbG9nKHRoaXMubG9nZ2VyLmluZm8sIC4uLm1zZyk7XG4gIH1cblxuICBsb2dWZXJib3NlKC4uLm1zZzogdW5rbm93bltdKSB7XG4gICAgdGhpcy4jbG9nKHRoaXMubG9nZ2VyLnZlcmJvc2UsIC4uLm1zZyk7XG4gIH1cblxuICBsb2dFcnJvciguLi5tc2c6IHVua25vd25bXSkge1xuICAgIHRoaXMuI2xvZyh0aGlzLmxvZ2dlci5lcnJvciwgLi4ubXNnKTtcbiAgfVxuXG4gICNsb2cobG9nRnVuYzogTG9nRnVuYywgLi4ubXNnOiB1bmtub3duW10pIHtcbiAgICBsb2dGdW5jLmNhbGwoXG4gICAgICB0aGlzLmxvZ2dlcixcbiAgICAgIFwiTUVBU1VSRVI6XCIsXG4gICAgICB0aGlzLm1lYXN1cmVtZW50VHlwZSgpLnRvVXBwZXJDYXNlKCksXG4gICAgICBcIjogXCIsXG4gICAgICAuLi5tc2csXG4gICAgKTtcbiAgfVxuXG4gIG1lYXN1cmVtZW50VHlwZSgpOiBNZWFzdXJlbWVudFR5cGUge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWRcIik7XG4gIH1cblxuICBpbnN0cnVtZW50KCkge1xuICAgIHRoaXMuY29udGV4dC5vbihcImNsb3NlXCIsICgpID0+IHtcbiAgICAgIHRoaXMuaXNDb250ZXh0Q2xvc2VkID0gdHJ1ZTtcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLmluc3RydW1lbnRlZEF0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiVHJ5aW5nIHRvIGluc3RydW1lbnQgYSBtZWFzdXJlciBpbnN0YW5jZSBhZnRlciBpdCBcIiArXG4gICAgICAgICAgYHdhcyBpbnN0cnVtZW50ZWQgYXQgXCIke3RoaXMuaW5zdHJ1bWVudGVkQXQudG9JU09TdHJpbmcoKX1cImAsXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLmluc3RydW1lbnRlZEF0ID0gbmV3IERhdGUoKTtcbiAgfVxuXG4gIGNsb3NlKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmNsb3NlZEF0KSB7XG4gICAgICB0aGlzLmxvZ0Vycm9yKFxuICAgICAgICBcIlRyaWVkIHRvIGNsb3NlIG1lYXN1cmVtZW50LCBidXQgaXQgd2FzIGFscmVhZHkgXCIgKyBcImNsb3NlZCBhdCBcIixcbiAgICAgICAgdGhpcy5jbG9zZWRBdC50b0lTT1N0cmluZygpLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZUlmT3BlbigpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgY2xvc2VJZk9wZW4oKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuY2xvc2VkQXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5sb2dWZXJib3NlKFwiRW5kaW5nIG1lYXN1cmVtZW50IGF0IFwiLCB0aGlzLmNsb3NlZEF0LnRvSVNPU3RyaW5nKCkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9yZXF1aXJlLWF3YWl0XG4gIGFzeW5jIGNvbGxlY3QoKTogUHJvbWlzZTxNZWFzdXJlbWVudFJlc3VsdCB8IG51bGw+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkXCIpO1xuICB9XG59XG4iXX0=