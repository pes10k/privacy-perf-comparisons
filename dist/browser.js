import assert from "node:assert/strict";
import { chromium, firefox, webkit } from "@playwright/test";
import { BrowserType, } from "./types.js";
const browserTypeMapping = {
    [BrowserType.Brave]: chromium,
    [BrowserType.Chromium]: chromium,
    [BrowserType.Gecko]: firefox,
    [BrowserType.WebKit]: webkit,
};
const launchArgsForBrave = (config) => {
    const launchArgs = launchArgsForChromium(config);
    launchArgs.push("--disable-brave-update");
    launchArgs.push("--disable-sync");
    return launchArgs;
};
const launchArgsForChromium = (config) => {
    const launchArgs = ["--disable-features=MacAppCodeSignClone"];
    if (config.profile) {
        launchArgs.push(`--profile-directory="${config.profile}`);
    }
    return launchArgs;
};
const launchArgsEmpty = () => {
    return [];
};
const launchArgsForConfig = (config) => {
    let launchArgsFunc;
    switch (config.browser) {
        case BrowserType.Brave:
            launchArgsFunc = launchArgsForBrave;
            break;
        case BrowserType.Chromium:
            launchArgsFunc = launchArgsForChromium;
            break;
        case BrowserType.Gecko:
            launchArgsFunc = launchArgsEmpty;
            break;
        case BrowserType.WebKit:
            launchArgsFunc = launchArgsEmpty;
            break;
    }
    assert(launchArgsFunc);
    const browserArgs = launchArgsFunc(config);
    const defaultBrowserArgs = [];
    const launchOptions = {
        args: defaultBrowserArgs.concat(browserArgs),
        executablePath: config.binary,
        screen: {
            height: config.viewport.height,
            width: config.viewport.width,
        },
        serviceWorkers: "allow",
        timeout: config.timeout * 1000,
        headless: false,
    };
    return launchOptions;
};
const getContext = async (browser, userDataDir, launchArgs) => {
    const browserType = browserTypeMapping[browser];
    assert(browserType);
    return await browserType.launchPersistentContext(userDataDir, launchArgs);
};
export const launch = async (logger, config) => {
    const browserType = config.browser;
    const userDataDir = config.userDataDir;
    const launchArgs = launchArgsForConfig(config);
    logger.info("Launching browser with arguments: ", launchArgs);
    return await getContext(browserType, userDataDir, launchArgs);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJvd3Nlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLG9CQUFvQixDQUFDO0FBRXhDLE9BQU8sRUFBa0IsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUc3RSxPQUFPLEVBQ0wsV0FBVyxHQUlaLE1BQU0sWUFBWSxDQUFDO0FBRXBCLE1BQU0sa0JBQWtCLEdBQUc7SUFDekIsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEVBQUUsUUFBUTtJQUM3QixDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRSxRQUFRO0lBQ2hDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLE9BQU87SUFDNUIsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTTtDQUM3QixDQUFDO0FBRUYsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLE1BQWlCLEVBQVksRUFBRTtJQUN6RCxNQUFNLFVBQVUsR0FBRyxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxVQUFVLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDMUMsVUFBVSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ2xDLE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQUVGLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxNQUFpQixFQUFZLEVBQUU7SUFDNUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBQzlELElBQUksTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25CLFVBQVUsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFDRCxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDLENBQUM7QUFFRixNQUFNLGVBQWUsR0FBRyxHQUFhLEVBQUU7SUFDckMsT0FBTyxFQUFFLENBQUM7QUFDWixDQUFDLENBQUM7QUFFRixNQUFNLG1CQUFtQixHQUFHLENBQUMsTUFBaUIsRUFBMkIsRUFBRTtJQUN6RSxJQUFJLGNBQWMsQ0FBQztJQUVuQixRQUFRLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN2QixLQUFLLFdBQVcsQ0FBQyxLQUFLO1lBQ3BCLGNBQWMsR0FBRyxrQkFBa0IsQ0FBQztZQUNwQyxNQUFNO1FBQ1IsS0FBSyxXQUFXLENBQUMsUUFBUTtZQUN2QixjQUFjLEdBQUcscUJBQXFCLENBQUM7WUFDdkMsTUFBTTtRQUNSLEtBQUssV0FBVyxDQUFDLEtBQUs7WUFDcEIsY0FBYyxHQUFHLGVBQWUsQ0FBQztZQUNqQyxNQUFNO1FBQ1IsS0FBSyxXQUFXLENBQUMsTUFBTTtZQUNyQixjQUFjLEdBQUcsZUFBZSxDQUFDO1lBQ2pDLE1BQU07SUFDVixDQUFDO0lBQ0QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZCLE1BQU0sV0FBVyxHQUFHLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUzQyxNQUFNLGtCQUFrQixHQUFhLEVBQUUsQ0FBQztJQUN4QyxNQUFNLGFBQWEsR0FBNEI7UUFDN0MsSUFBSSxFQUFFLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDNUMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxNQUFNO1FBQzdCLE1BQU0sRUFBRTtZQUNOLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU07WUFDOUIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSztTQUM3QjtRQUNELGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUk7UUFDOUIsUUFBUSxFQUFFLEtBQUs7S0FDaEIsQ0FBQztJQUVGLE9BQU8sYUFBYSxDQUFDO0FBQ3ZCLENBQUMsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFDdEIsT0FBb0IsRUFDcEIsV0FBaUIsRUFDakIsVUFBbUMsRUFDVixFQUFFO0lBQzNCLE1BQU0sV0FBVyxHQUFHLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwQixPQUFPLE1BQU0sV0FBVyxDQUFDLHVCQUF1QixDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM1RSxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUN6QixNQUFjLEVBQ2QsTUFBaUIsRUFDUSxFQUFFO0lBQzNCLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDbkMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxNQUFNLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sTUFBTSxVQUFVLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNoRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0IGZyb20gXCJub2RlOmFzc2VydC9zdHJpY3RcIjtcblxuaW1wb3J0IHsgQnJvd3NlckNvbnRleHQsIGNocm9taXVtLCBmaXJlZm94LCB3ZWJraXQgfSBmcm9tIFwiQHBsYXl3cmlnaHQvdGVzdFwiO1xuXG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi9sb2dnaW5nLmpzXCI7XG5pbXBvcnQge1xuICBCcm93c2VyVHlwZSxcbiAgUGVyc2lzdGVudExhdW5jaE9wdGlvbnMsXG4gIFBhdGgsXG4gIFJ1bkNvbmZpZyxcbn0gZnJvbSBcIi4vdHlwZXMuanNcIjtcblxuY29uc3QgYnJvd3NlclR5cGVNYXBwaW5nID0ge1xuICBbQnJvd3NlclR5cGUuQnJhdmVdOiBjaHJvbWl1bSxcbiAgW0Jyb3dzZXJUeXBlLkNocm9taXVtXTogY2hyb21pdW0sXG4gIFtCcm93c2VyVHlwZS5HZWNrb106IGZpcmVmb3gsXG4gIFtCcm93c2VyVHlwZS5XZWJLaXRdOiB3ZWJraXQsXG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRm9yQnJhdmUgPSAoY29uZmlnOiBSdW5Db25maWcpOiBzdHJpbmdbXSA9PiB7XG4gIGNvbnN0IGxhdW5jaEFyZ3MgPSBsYXVuY2hBcmdzRm9yQ2hyb21pdW0oY29uZmlnKTtcbiAgbGF1bmNoQXJncy5wdXNoKFwiLS1kaXNhYmxlLWJyYXZlLXVwZGF0ZVwiKTtcbiAgbGF1bmNoQXJncy5wdXNoKFwiLS1kaXNhYmxlLXN5bmNcIik7XG4gIHJldHVybiBsYXVuY2hBcmdzO1xufTtcblxuY29uc3QgbGF1bmNoQXJnc0ZvckNocm9taXVtID0gKGNvbmZpZzogUnVuQ29uZmlnKTogc3RyaW5nW10gPT4ge1xuICBjb25zdCBsYXVuY2hBcmdzID0gW1wiLS1kaXNhYmxlLWZlYXR1cmVzPU1hY0FwcENvZGVTaWduQ2xvbmVcIl07XG4gIGlmIChjb25maWcucHJvZmlsZSkge1xuICAgIGxhdW5jaEFyZ3MucHVzaChgLS1wcm9maWxlLWRpcmVjdG9yeT1cIiR7Y29uZmlnLnByb2ZpbGV9YCk7XG4gIH1cbiAgcmV0dXJuIGxhdW5jaEFyZ3M7XG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRW1wdHkgPSAoKTogc3RyaW5nW10gPT4ge1xuICByZXR1cm4gW107XG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRm9yQ29uZmlnID0gKGNvbmZpZzogUnVuQ29uZmlnKTogUGVyc2lzdGVudExhdW5jaE9wdGlvbnMgPT4ge1xuICBsZXQgbGF1bmNoQXJnc0Z1bmM7XG5cbiAgc3dpdGNoIChjb25maWcuYnJvd3Nlcikge1xuICAgIGNhc2UgQnJvd3NlclR5cGUuQnJhdmU6XG4gICAgICBsYXVuY2hBcmdzRnVuYyA9IGxhdW5jaEFyZ3NGb3JCcmF2ZTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQnJvd3NlclR5cGUuQ2hyb21pdW06XG4gICAgICBsYXVuY2hBcmdzRnVuYyA9IGxhdW5jaEFyZ3NGb3JDaHJvbWl1bTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQnJvd3NlclR5cGUuR2Vja286XG4gICAgICBsYXVuY2hBcmdzRnVuYyA9IGxhdW5jaEFyZ3NFbXB0eTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQnJvd3NlclR5cGUuV2ViS2l0OlxuICAgICAgbGF1bmNoQXJnc0Z1bmMgPSBsYXVuY2hBcmdzRW1wdHk7XG4gICAgICBicmVhaztcbiAgfVxuICBhc3NlcnQobGF1bmNoQXJnc0Z1bmMpO1xuICBjb25zdCBicm93c2VyQXJncyA9IGxhdW5jaEFyZ3NGdW5jKGNvbmZpZyk7XG5cbiAgY29uc3QgZGVmYXVsdEJyb3dzZXJBcmdzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBsYXVuY2hPcHRpb25zOiBQZXJzaXN0ZW50TGF1bmNoT3B0aW9ucyA9IHtcbiAgICBhcmdzOiBkZWZhdWx0QnJvd3NlckFyZ3MuY29uY2F0KGJyb3dzZXJBcmdzKSxcbiAgICBleGVjdXRhYmxlUGF0aDogY29uZmlnLmJpbmFyeSxcbiAgICBzY3JlZW46IHtcbiAgICAgIGhlaWdodDogY29uZmlnLnZpZXdwb3J0LmhlaWdodCxcbiAgICAgIHdpZHRoOiBjb25maWcudmlld3BvcnQud2lkdGgsXG4gICAgfSxcbiAgICBzZXJ2aWNlV29ya2VyczogXCJhbGxvd1wiLFxuICAgIHRpbWVvdXQ6IGNvbmZpZy50aW1lb3V0ICogMTAwMCxcbiAgICBoZWFkbGVzczogZmFsc2UsXG4gIH07XG5cbiAgcmV0dXJuIGxhdW5jaE9wdGlvbnM7XG59O1xuXG5jb25zdCBnZXRDb250ZXh0ID0gYXN5bmMgKFxuICBicm93c2VyOiBCcm93c2VyVHlwZSxcbiAgdXNlckRhdGFEaXI6IFBhdGgsXG4gIGxhdW5jaEFyZ3M6IFBlcnNpc3RlbnRMYXVuY2hPcHRpb25zLFxuKTogUHJvbWlzZTxCcm93c2VyQ29udGV4dD4gPT4ge1xuICBjb25zdCBicm93c2VyVHlwZSA9IGJyb3dzZXJUeXBlTWFwcGluZ1ticm93c2VyXTtcbiAgYXNzZXJ0KGJyb3dzZXJUeXBlKTtcbiAgcmV0dXJuIGF3YWl0IGJyb3dzZXJUeXBlLmxhdW5jaFBlcnNpc3RlbnRDb250ZXh0KHVzZXJEYXRhRGlyLCBsYXVuY2hBcmdzKTtcbn07XG5cbmV4cG9ydCBjb25zdCBsYXVuY2ggPSBhc3luYyAoXG4gIGxvZ2dlcjogTG9nZ2VyLFxuICBjb25maWc6IFJ1bkNvbmZpZyxcbik6IFByb21pc2U8QnJvd3NlckNvbnRleHQ+ID0+IHtcbiAgY29uc3QgYnJvd3NlclR5cGUgPSBjb25maWcuYnJvd3NlcjtcbiAgY29uc3QgdXNlckRhdGFEaXIgPSBjb25maWcudXNlckRhdGFEaXI7XG4gIGNvbnN0IGxhdW5jaEFyZ3MgPSBsYXVuY2hBcmdzRm9yQ29uZmlnKGNvbmZpZyk7XG4gIGxvZ2dlci5pbmZvKFwiTGF1bmNoaW5nIGJyb3dzZXIgd2l0aCBhcmd1bWVudHM6IFwiLCBsYXVuY2hBcmdzKTtcbiAgcmV0dXJuIGF3YWl0IGdldENvbnRleHQoYnJvd3NlclR5cGUsIHVzZXJEYXRhRGlyLCBsYXVuY2hBcmdzKTtcbn07XG4iXX0=