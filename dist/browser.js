import assert from "node:assert/strict";
import { chromium, firefox, webkit } from "playwright";
import { BrowserType } from "./types.js";
const browserTypeMapping = {
    [BrowserType.Brave]: chromium,
    [BrowserType.Chromium]: chromium,
    [BrowserType.Gecko]: firefox,
    [BrowserType.WebKit]: webkit,
};
const launchArgsForBrave = (config) => {
    const launchArgs = launchArgsForChromium(config);
    launchArgs.push("--disable-brave-update");
    launchArgs.push("--disable-sync");
    return launchArgs;
};
const launchArgsForChromium = (config) => {
    const launchArgs = ["--disable-features=MacAppCodeSignClone"];
    if (config.profile) {
        launchArgs.push(`--profile-directory="${config.profile}`);
    }
    return launchArgs;
};
const launchArgsEmpty = () => {
    return [];
};
const launchArgsForConfig = (config) => {
    let launchArgsFunc;
    switch (config.browser) {
        case BrowserType.Brave:
            launchArgsFunc = launchArgsForBrave;
            break;
        case BrowserType.Chromium:
            launchArgsFunc = launchArgsForChromium;
            break;
        case BrowserType.Gecko:
            launchArgsFunc = launchArgsEmpty;
            break;
        case BrowserType.WebKit:
            launchArgsFunc = launchArgsEmpty;
            break;
    }
    assert(launchArgsFunc);
    const browserArgs = launchArgsFunc(config);
    const defaultBrowserArgs = [];
    const launchArgs = {
        args: defaultBrowserArgs.concat(browserArgs),
        executablePath: config.binary,
        screen: {
            height: config.viewport.height,
            width: config.viewport.width,
        },
        serviceWorkers: "allow",
        timeout: config.timeout * 1000,
        headless: false,
    };
    return launchArgs;
};
const getContext = async (browser, userDataDir, launchArgs) => {
    const browserType = browserTypeMapping[browser];
    assert(browserType);
    return await browserType.launchPersistentContext(userDataDir, launchArgs);
};
export const launch = async (logger, config) => {
    const browserType = config.browser;
    const userDataDir = config.userDataDir;
    const launchArgs = launchArgsForConfig(config);
    logger.info("Launching browser with arguments: ", launchArgs);
    return await getContext(browserType, userDataDir, launchArgs);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJvd3Nlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9icm93c2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLG9CQUFvQixDQUFDO0FBRXhDLE9BQU8sRUFBa0IsUUFBUSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHdkUsT0FBTyxFQUFFLFdBQVcsRUFBK0IsTUFBTSxZQUFZLENBQUM7QUFFdEUsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsRUFBRSxRQUFRO0lBQzdCLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVE7SUFDaEMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTztJQUM1QixDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNO0NBQzdCLENBQUM7QUFFRixNQUFNLGtCQUFrQixHQUFHLENBQUMsTUFBaUIsRUFBWSxFQUFFO0lBQ3pELE1BQU0sVUFBVSxHQUFHLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pELFVBQVUsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUMxQyxVQUFVLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbEMsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLE1BQWlCLEVBQVksRUFBRTtJQUM1RCxNQUFNLFVBQVUsR0FBRyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7SUFDOUQsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbkIsVUFBVSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUNELE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQUVGLE1BQU0sZUFBZSxHQUFHLEdBQWEsRUFBRTtJQUNyQyxPQUFPLEVBQUUsQ0FBQztBQUNaLENBQUMsQ0FBQztBQUVGLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxNQUFpQixFQUFjLEVBQUU7SUFDNUQsSUFBSSxjQUFjLENBQUM7SUFFbkIsUUFBUSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDdkIsS0FBSyxXQUFXLENBQUMsS0FBSztZQUNwQixjQUFjLEdBQUcsa0JBQWtCLENBQUM7WUFDcEMsTUFBTTtRQUNSLEtBQUssV0FBVyxDQUFDLFFBQVE7WUFDdkIsY0FBYyxHQUFHLHFCQUFxQixDQUFDO1lBQ3ZDLE1BQU07UUFDUixLQUFLLFdBQVcsQ0FBQyxLQUFLO1lBQ3BCLGNBQWMsR0FBRyxlQUFlLENBQUM7WUFDakMsTUFBTTtRQUNSLEtBQUssV0FBVyxDQUFDLE1BQU07WUFDckIsY0FBYyxHQUFHLGVBQWUsQ0FBQztZQUNqQyxNQUFNO0lBQ1YsQ0FBQztJQUNELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUN2QixNQUFNLFdBQVcsR0FBRyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFM0MsTUFBTSxrQkFBa0IsR0FBYSxFQUFFLENBQUM7SUFDeEMsTUFBTSxVQUFVLEdBQWU7UUFDN0IsSUFBSSxFQUFFLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDNUMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxNQUFNO1FBQzdCLE1BQU0sRUFBRTtZQUNOLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU07WUFDOUIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSztTQUM3QjtRQUNELGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUk7UUFDOUIsUUFBUSxFQUFFLEtBQUs7S0FDaEIsQ0FBQztJQUVGLE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFDdEIsT0FBb0IsRUFDcEIsV0FBaUIsRUFDakIsVUFBc0IsRUFDRyxFQUFFO0lBQzNCLE1BQU0sV0FBVyxHQUFHLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwQixPQUFPLE1BQU0sV0FBVyxDQUFDLHVCQUF1QixDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUM1RSxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxFQUN6QixNQUFjLEVBQ2QsTUFBaUIsRUFDUSxFQUFFO0lBQzNCLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDbkMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxNQUFNLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sTUFBTSxVQUFVLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNoRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0IGZyb20gXCJub2RlOmFzc2VydC9zdHJpY3RcIjtcblxuaW1wb3J0IHsgQnJvd3NlckNvbnRleHQsIGNocm9taXVtLCBmaXJlZm94LCB3ZWJraXQgfSBmcm9tIFwicGxheXdyaWdodFwiO1xuXG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi9sb2dnaW5nLmpzXCI7XG5pbXBvcnQgeyBCcm93c2VyVHlwZSwgTGF1bmNoQXJncywgUGF0aCwgUnVuQ29uZmlnIH0gZnJvbSBcIi4vdHlwZXMuanNcIjtcblxuY29uc3QgYnJvd3NlclR5cGVNYXBwaW5nID0ge1xuICBbQnJvd3NlclR5cGUuQnJhdmVdOiBjaHJvbWl1bSxcbiAgW0Jyb3dzZXJUeXBlLkNocm9taXVtXTogY2hyb21pdW0sXG4gIFtCcm93c2VyVHlwZS5HZWNrb106IGZpcmVmb3gsXG4gIFtCcm93c2VyVHlwZS5XZWJLaXRdOiB3ZWJraXQsXG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRm9yQnJhdmUgPSAoY29uZmlnOiBSdW5Db25maWcpOiBzdHJpbmdbXSA9PiB7XG4gIGNvbnN0IGxhdW5jaEFyZ3MgPSBsYXVuY2hBcmdzRm9yQ2hyb21pdW0oY29uZmlnKTtcbiAgbGF1bmNoQXJncy5wdXNoKFwiLS1kaXNhYmxlLWJyYXZlLXVwZGF0ZVwiKTtcbiAgbGF1bmNoQXJncy5wdXNoKFwiLS1kaXNhYmxlLXN5bmNcIik7XG4gIHJldHVybiBsYXVuY2hBcmdzO1xufTtcblxuY29uc3QgbGF1bmNoQXJnc0ZvckNocm9taXVtID0gKGNvbmZpZzogUnVuQ29uZmlnKTogc3RyaW5nW10gPT4ge1xuICBjb25zdCBsYXVuY2hBcmdzID0gW1wiLS1kaXNhYmxlLWZlYXR1cmVzPU1hY0FwcENvZGVTaWduQ2xvbmVcIl07XG4gIGlmIChjb25maWcucHJvZmlsZSkge1xuICAgIGxhdW5jaEFyZ3MucHVzaChgLS1wcm9maWxlLWRpcmVjdG9yeT1cIiR7Y29uZmlnLnByb2ZpbGV9YCk7XG4gIH1cbiAgcmV0dXJuIGxhdW5jaEFyZ3M7XG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRW1wdHkgPSAoKTogc3RyaW5nW10gPT4ge1xuICByZXR1cm4gW107XG59O1xuXG5jb25zdCBsYXVuY2hBcmdzRm9yQ29uZmlnID0gKGNvbmZpZzogUnVuQ29uZmlnKTogTGF1bmNoQXJncyA9PiB7XG4gIGxldCBsYXVuY2hBcmdzRnVuYztcblxuICBzd2l0Y2ggKGNvbmZpZy5icm93c2VyKSB7XG4gICAgY2FzZSBCcm93c2VyVHlwZS5CcmF2ZTpcbiAgICAgIGxhdW5jaEFyZ3NGdW5jID0gbGF1bmNoQXJnc0ZvckJyYXZlO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBCcm93c2VyVHlwZS5DaHJvbWl1bTpcbiAgICAgIGxhdW5jaEFyZ3NGdW5jID0gbGF1bmNoQXJnc0ZvckNocm9taXVtO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBCcm93c2VyVHlwZS5HZWNrbzpcbiAgICAgIGxhdW5jaEFyZ3NGdW5jID0gbGF1bmNoQXJnc0VtcHR5O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBCcm93c2VyVHlwZS5XZWJLaXQ6XG4gICAgICBsYXVuY2hBcmdzRnVuYyA9IGxhdW5jaEFyZ3NFbXB0eTtcbiAgICAgIGJyZWFrO1xuICB9XG4gIGFzc2VydChsYXVuY2hBcmdzRnVuYyk7XG4gIGNvbnN0IGJyb3dzZXJBcmdzID0gbGF1bmNoQXJnc0Z1bmMoY29uZmlnKTtcblxuICBjb25zdCBkZWZhdWx0QnJvd3NlckFyZ3M6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IGxhdW5jaEFyZ3M6IExhdW5jaEFyZ3MgPSB7XG4gICAgYXJnczogZGVmYXVsdEJyb3dzZXJBcmdzLmNvbmNhdChicm93c2VyQXJncyksXG4gICAgZXhlY3V0YWJsZVBhdGg6IGNvbmZpZy5iaW5hcnksXG4gICAgc2NyZWVuOiB7XG4gICAgICBoZWlnaHQ6IGNvbmZpZy52aWV3cG9ydC5oZWlnaHQsXG4gICAgICB3aWR0aDogY29uZmlnLnZpZXdwb3J0LndpZHRoLFxuICAgIH0sXG4gICAgc2VydmljZVdvcmtlcnM6IFwiYWxsb3dcIixcbiAgICB0aW1lb3V0OiBjb25maWcudGltZW91dCAqIDEwMDAsXG4gICAgaGVhZGxlc3M6IGZhbHNlLFxuICB9O1xuXG4gIHJldHVybiBsYXVuY2hBcmdzO1xufTtcblxuY29uc3QgZ2V0Q29udGV4dCA9IGFzeW5jIChcbiAgYnJvd3NlcjogQnJvd3NlclR5cGUsXG4gIHVzZXJEYXRhRGlyOiBQYXRoLFxuICBsYXVuY2hBcmdzOiBMYXVuY2hBcmdzLFxuKTogUHJvbWlzZTxCcm93c2VyQ29udGV4dD4gPT4ge1xuICBjb25zdCBicm93c2VyVHlwZSA9IGJyb3dzZXJUeXBlTWFwcGluZ1ticm93c2VyXTtcbiAgYXNzZXJ0KGJyb3dzZXJUeXBlKTtcbiAgcmV0dXJuIGF3YWl0IGJyb3dzZXJUeXBlLmxhdW5jaFBlcnNpc3RlbnRDb250ZXh0KHVzZXJEYXRhRGlyLCBsYXVuY2hBcmdzKTtcbn07XG5cbmV4cG9ydCBjb25zdCBsYXVuY2ggPSBhc3luYyAoXG4gIGxvZ2dlcjogTG9nZ2VyLFxuICBjb25maWc6IFJ1bkNvbmZpZyxcbik6IFByb21pc2U8QnJvd3NlckNvbnRleHQ+ID0+IHtcbiAgY29uc3QgYnJvd3NlclR5cGUgPSBjb25maWcuYnJvd3NlcjtcbiAgY29uc3QgdXNlckRhdGFEaXIgPSBjb25maWcudXNlckRhdGFEaXI7XG4gIGNvbnN0IGxhdW5jaEFyZ3MgPSBsYXVuY2hBcmdzRm9yQ29uZmlnKGNvbmZpZyk7XG4gIGxvZ2dlci5pbmZvKFwiTGF1bmNoaW5nIGJyb3dzZXIgd2l0aCBhcmd1bWVudHM6IFwiLCBsYXVuY2hBcmdzKTtcbiAgcmV0dXJuIGF3YWl0IGdldENvbnRleHQoYnJvd3NlclR5cGUsIHVzZXJEYXRhRGlyLCBsYXVuY2hBcmdzKTtcbn07XG4iXX0=